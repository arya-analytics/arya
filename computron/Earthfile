VERSION 0.7
# Use debian:bullseye for a more stable base with compatible GLIBC
FROM debian:bullseye

deps:
    # Install Python build dependencies including SSL
    RUN apt-get update && apt-get install -y \
        python3 \
        python3-pip \
        python3-dev \
        build-essential \
        libssl-dev \
        zlib1g-dev \
        libncurses5-dev \
        libgdbm-dev \
        libnss3-dev \
        libreadline-dev \
        libffi-dev \
        libsqlite3-dev \
        golang-1.23

build:
    FROM +deps
    WORKDIR /computron
    COPY . .
    RUN chmod +x build-linux.sh
    RUN ./build-linux.sh
    SAVE ARTIFACT /computron/python_install /python_install

source:
    FROM +deps
    WORKDIR /computron
    COPY . .
    COPY +build/python_install ./python_install
    SAVE ARTIFACT . /computron