VERSION 0.7
FROM golang:1.23-bullseye

deps:
    # Install Python build dependencies including SSL
    RUN apt-get update && apt-get install -y \
        python3 \
        python3-pip \
        python3-dev \
        build-essential \
        libssl-dev \
        zlib1g-dev \
        libncurses5-dev \
        libgdbm-dev \
        libnss3-dev \
        libreadline-dev \
        libffi-dev \
        libsqlite3-dev

build:
    FROM +deps
    WORKDIR /computron
    COPY . .
    RUN chmod +x build-linux.sh
    RUN ./build-linux.sh
    SAVE ARTIFACT /computron/python_install /python_install

source:
    FROM +build
    SAVE ARTIFACT /computron/python_install /computron